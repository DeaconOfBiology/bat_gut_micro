#!/bin/bash
#SBATCH --partition=Orion
#SBATCH --job-name=Titan_run
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=10
#SBATCH --mem=200gb
#SBATCH --time=02-00:00:00

#SBATCH --error=../slurm/%x_%j.err
#SBATCH --output=../slurm/%x_%j.out



# # Load modules to retreive host sequences:
# module purg
# module load mambaforge/4.14
# mamba activate ncbi_datasets

# #### Running datasets to retrieve sequences
# datasets download genome accession --inputfile /projects/raw_lab/projects/Bats/bat_gut_micro/data/references/bat_host_accessions.txt \
#     --include gff3,rna,cds,protein,genome,seq-report \
#     --filename /projects/raw_lab/projects/Bats/bat_gut_micro/data/references/bat_references.zip

# unzip /projects/raw_lab/projects/Bats/bat_gut_micro/data/references/bat_references.zip -d /projects/raw_lab/projects/Bats/bat_gut_micro/data/references/

# cat /projects/raw_lab/projects/Bats/bat_gut_micro/data/references/ncbi_dataset/data/*/*_genomic.fna > /projects/raw_lab/projects/Bats/bat_gut_micro/data/references/concat_bat_host_reference.fasta

# Load modules:
module purge
module load anaconda3
eval "$(conda shell.bash hook)"
conda activate /projects/raw_lab/envs/titanomics-0.2

# Titan:
#Megahit run
# titanomics.py --super /projects/raw_lab/projects/Bats/bat_gut_micro/data/raw/shotgun \
#     --illumina --subsample 2500 --cpus $SLURM_CPUS_ON_NODE \
#     --dir_out /projects/raw_lab/projects/Bats/bat_gut_micro/titan_project/data/processed/titan_output/decon_megahit

#Metaspades run with decontamination
titanomics.py --super /projects/raw_lab/projects/Bats/bat_gut_micro/data/raw/shotgun \
    --illumina --spades --subsample 2500 --cpus $SLURM_CPUS_ON_NODE \
    --dir_out /projects/raw_lab/projects/Bats/bat_gut_micro/titan_project/data/processed/titan_output/decon_spades